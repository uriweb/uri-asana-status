window.addEventListener("load",(async()=>{const t={parent:document.getElementById("uri-asana-status")};if(null===t.parent)return!1;t.message=t.parent.getElementsByClassName("uri-asana-status-message")[0];const s={accept:"application/json",authorization:`Bearer ${uriAsanaStatus.token}`};!async function(t,s){const a=await fetch("https://app.asana.com/api/1.0/users/me",{headers:t});a.ok||(s.message.innerHTML="Your personal access token is invalid. For documentation, see: https://developers.asana.com/docs/personal-access-token")}(s,t);const a=await async function(t,s,a){a.message.innerHTML='<span class="loading"></span>Loading...';try{let a=await async function(t,s){const a={method:"GET",headers:s},e=10;let n=0;for(;n<e;){const s=await fetch(`https://app.asana.com/api/1.0/projects/${t}/tasks?opt_fields=custom_fields.name,custom_fields.display_value&completed_since=now&opt_pretty=true`,a);if(200===s.status)return(await s.json()).data;if(s.status>=400&&429!==s.status&&500!==s.status){console.error("Could not retrieve tasks");break}n++;const e=n*n*120;await new Promise((t=>setTimeout(t,e)))}return[]}(t,s);const e=new Array;for(const t in a){let s=a[t],n={};for(const t in s.custom_fields){let a=s.custom_fields[t];switch(a.name){case"RID":n.rid=a.display_value;break;case"Status":n.status=a.display_value}}e.push(n)}return e}catch(t){console.error(t),a.message.innerHTML="Something went wrong... inpect the page to view the dev console or wait and try again"}}(uriAsanaStatus.project,s,t);!function(t,s){let a=document.createElement("ul");a.classList="uri-asana-results type-mono";for(let s in t){let e=t[s],n=document.createElement("li");if(!0===uriAsanaStatus.simplify||"true"===uriAsanaStatus.simplify)switch(e.status){case"Request":e.status="Recieved";break;case"Scoping":e.status="Evaluating";break;default:e.status="In Progress"}n.classList=`task ${e.status.toLowerCase().replace(" ","-")}`;let i=`<div class="task-id">${e.rid}</div>`;i+=`<div class="task-status">${e.status}</div>`,n.innerHTML=i,a.appendChild(n)}s.message.innerHTML="",s.parent.appendChild(a)}(a,t)}),!1);